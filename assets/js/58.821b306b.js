(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{468:function(a,t,s){"use strict";s.r(t);var e=s(2),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"_0、环境介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_0、环境介绍"}},[a._v("#")]),a._v(" 0、环境介绍")]),a._v(" "),t("p",[a._v("系统环境："),t("code",[a._v("Ubuntu 22.04.4 LTS")]),t("br"),a._v("\n目标系统："),t("code",[a._v("ubuntu 20.04.4 armhf")])]),a._v(" "),t("h2",{attrs:{id:"_1、安装环境-建立目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装环境-建立目录"}},[a._v("#")]),a._v(" 1、安装环境&建立目录")]),a._v(" "),t("p",[a._v("安装环境")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("apt update\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("apt install qemu-user-static -y\n")])])]),t("p",[a._v("建立工作目录")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mkdir /var/rootfs\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cd /var/rootfs\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mkdir ubuntu-base\n")])])]),t("h2",{attrs:{id:"_2、下载ubuntu-base"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、下载ubuntu-base"}},[a._v("#")]),a._v(" 2、下载Ubuntu Base")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("wget --no-check-certificate https://cdimage.ubuntu.com/ubuntu-base/releases/20.04/release/ubuntu-base-20.04.4-base-armhf.tar.gz\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("tar -zxvf ubuntu-base-20.04.4-base-armhf.tar.gz -C ./ubuntu-base\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cd ./ubuntu-base\n")])])]),t("h2",{attrs:{id:"_3、配置qemu"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、配置qemu"}},[a._v("#")]),a._v(" 3、配置QEMU")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cp /usr/bin/qemu-arm-static ./usr/bin/\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cp /etc/resolv.conf ./etc/resolv.conf\n")])])]),t("h2",{attrs:{id:"_4、使用chroot进入ubuntu-base"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、使用chroot进入ubuntu-base"}},[a._v("#")]),a._v(" 4、使用Chroot进入Ubuntu Base")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("chroot ./\n")])])]),t("p",[a._v("开始操作Ubuntu Base")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("apt update\n")])])]),t("p",[a._v("修改密码")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("passwd root\n")])])]),t("p",[a._v("安装日常必须Apps（时间有点长，耐心等待15分钟左右）")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("apt install -y systemd systemd-sysv sudo net-tools ethtool ifupdown iputils-ping vim ssh bash-completion locales language-pack-en-base\n")])])]),t("p",[a._v("Bash自动化")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("vim /root/.bashrc\n")])])]),t("p",[a._v("去掉注释")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("if [ -f /etc/bash_completion ] && ! shopt -oq posix; then\n    . /etc/bash_completion\nfi\n")])])]),t("p",[a._v("给设备命名（包括网络名称）")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("echo HiNAS > /etc/hostname\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("echo 127.0.0.1 localhost > /etc/hosts\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("echo 127.0.0.1 HiNAS >> /etc/hosts\n")])])]),t("p",[a._v("允许用root用户登录")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("echo PermitRootLogin yes >> /etc/ssh/sshd_config\n")])])]),t("p",[a._v("配置挂载系统")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("vim /etc/fstab\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# <file system>   <dir>         <type>    <options>                          <dump> <pass>\n/dev/mmcblk0p9    /             ext4      defaults,noatime,errors=remount-ro 0      1\n")])])]),t("p",[a._v("配置调试端口")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ln -s /lib/systemd/system/getty\\@.service /etc/systemd/system/getty.target.wants/getty\\@ttyAMA0.service\n")])])]),t("p",[a._v("配置自动获取IP")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("echo auto eth0 > /etc/network/interfaces.d/eth0\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("echo iface eth0 inet dhcp >> /etc/network/interfaces.d/eth0\n")])])]),t("p",[a._v("最后退出Chroot环境")]),a._v(" "),t("blockquote",[t("p",[a._v("CTRL+D")])]),a._v(" "),t("h2",{attrs:{id:"_5、制作镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、制作镜像"}},[a._v("#")]),a._v(" 5、制作镜像")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cd ..\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mkdir rootfs\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("dd if=/dev/zero of=./rootfs.ext4 bs=1M count=1024\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mkfs.ext4 rootfs.ext4\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mount -o loop rootfs.ext4 ./rootfs\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cp -rf ubuntu-base/* rootfs/\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("umount rootfs\n")])])]),t("p",[a._v("最后获得镜像roofs.ext4是我们需要的文件")])])}),[],!1,null,null,null);t.default=r.exports}}]);